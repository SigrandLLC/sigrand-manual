<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Quality of service</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="SG-17R User Manual"><link rel="up" href="ch08.html" title="Chapter 8. Traffic control"><link rel="prev" href="ch08s03.html" title="NAT"><link rel="next" href="ch09.html" title="Chapter 9. Network services settings"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Quality of service</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch08s03.html">Prev</a> </td><th width="60%" align="center">Chapter 8. Traffic control</th><td width="20%" align="right"> <a accesskey="n" href="ch09.html">Next</a></td></tr></table><hr></div><div class="section" title="Quality of service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="qos"></a>Quality of service</h2></div></div></div><p>Quality of service (QoS) allows to change the sequence of traffic
      pass at the interface. Different disciplines of service provide
      different opportunities of traffic classification and control.</p><p>QoS adjustment is done on the interface configuration page, QoS
      tab.</p><div class="figure"><a name="id429283"></a><p class="title"><b>Figure 8.17. QoS setting</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos.png" width="540" alt="QoS setting"></td></tr></table></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>TX queue length</em></span> — outgoing queue of the
          interface, measured in packets. If no settings are made, the value
          on default is set for the interface automatically.</p></li><li class="listitem"><p><span class="emphasis"><em>Scheduler</em></span> — discipline of traffic
          service.</p></li></ul></div><div class="section" title="Classless discipline pfifo_fast"><div class="titlepage"><div><div><h3 class="title"><a name="pfifo_fast"></a>Classless discipline pfifo_fast</h3></div></div></div><p>Standard discipline of traffic servicing, realizing a simple
        mechanism First In First Out. Consists of three lines — 0, 1 and 2. The
        line 0 is served until it contains packets, queued for tranfer. Then
        lines 1 and two are serviced in the same way.</p><p>Traffic distribution along the lines can be performed by means
        of bit installation ToS — Type of Service, which is produced by the
        software generating the traffic or by means of the firewall. There
        exist fourToS bits:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Minimum Delay</em></span>;</p></li><li class="listitem"><p><span class="emphasis"><em>Maximum Throughput</em></span>;</p></li><li class="listitem"><p><span class="emphasis"><em>Maximum Reliability</em></span>;</p></li><li class="listitem"><p><span class="emphasis"><em>Minimum Cost</em></span> — minimum channel
            cost;</p></li></ul></div><div class="important" title="Important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>In currebt version of web-interface of the router installation
          of ToS bits by means of the firewall is not available. For this
          purpose the console interface of the router can be used.</p></div></div><div class="section" title="Classless disciplines FIFO with bytes buffer (bfifo) and FIFO with packets buffer (pfifo)"><div class="titlepage"><div><div><h3 class="title"><a name="bfifo-pfifo"></a>Classless disciplines FIFO with bytes buffer (bfifo) and FIFO
        with packets buffer (pfifo)</h3></div></div></div><p>The simpliest service disciplines. Do not have internal lines,
        all traffic is equal. Allow to obtain some statistics of their
        performance.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>limit</em></span> — queue length, for bfifo — in
            bites, for pfifo — in packets.</p></li></ul></div></div><div class="section" title="Classless discipline SFQ"><div class="titlepage"><div><div><h3 class="title"><a name="sfq"></a>Classless discipline SFQ</h3></div></div></div><p>SFQ — Stochastic Fairness Queueing — fair planning discipline.
        It operates with such notions as "flow" — TCP session or UDP data
        flow, for each of which a separate pseudo-queue is created as a part
        of the discipline. The discipline switches successively between the
        pseudo-queues (round robin), not allowing any of the flows to
        monopolize the channel.</p><p>For session distribution along the pseudo-queues hashes are used
        which need reconfiguration for the improvement of the discipline
        performance. The discipline is configured according to several
        parameters.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>perturb</em></span> — time interval in seconds, in
            which hash reconfiguration is performed. Recommended value —
            10.</p></li><li class="listitem"><p><span class="emphasis"><em>quantum</em></span> — number of bytes, which are
            extracted from the queue during one "step" (before switching to
            another queue). On default equal to maximum transmission unit
            (MTU), and must not exceed it!</p></li><li class="listitem"><p><span class="emphasis"><em>limit</em></span> — number of packets which can be
            queued. In case the number is exceeded, packets will be
            dropped.</p></li></ul></div><p>When installing the SFQ discipline to web-interface, the above
        mentioned settings are made automatically taking into account the
        recommended values.</p></div><div class="section" title="Classless discipline ESFQ"><div class="titlepage"><div><div><h3 class="title"><a name="id429483"></a>Classless discipline ESFQ</h3></div></div></div><p>ESFQ — Enhanced Stochastic Fairness Queueing — improved SFQ
        discipline. It provides more opportunities for setting, which allows
        more equal distribution of the bandwidth. For example, if the user
        launches programs operating in several flows, the usual SFQ becomes
        ineffective, as it cannot divide the channel between the users. ESFQ
        discipline allows to choose another algorithm of hashing, for example,
        using the source IP-address or the destination IP-address, which
        allows to distribute different users to different pseudo-queues
        indepandable of the number of sessions for each user.</p><div class="figure"><a name="id429502"></a><p class="title"><b>Figure 8.18. ESFQ configuration</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos-esfq.png" width="540" alt="ESFQ configuration"></td></tr></table></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Limit</em></span> — number of packets that can be
            queued. In case the number is exceeded, packets will be
            dropped.</p></li><li class="listitem"><p><span class="emphasis"><em>Depth</em></span> — maximum number of pseudo-queues
            (in SFQ this number is strictly limited to 1024).</p></li><li class="listitem"><p><span class="emphasis"><em>Hash</em></span> — hash type.</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><span class="emphasis"><em>Classic</em></span> — analogous of that used in
                SFQ.</p></li><li class="listitem"><p><span class="emphasis"><em>Source address</em></span> — address of the
                sender.</p></li><li class="listitem"><p><span class="emphasis"><em>Destination address</em></span> — address of
                the recepient.</p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>perturb</em></span> — time interval in seconds in
            which the hash reconfiguration is performed. Recommended value -
            10 (when installing the discipline via web-interface the
            recommended value is set automatically).</p></li></ul></div></div><div class="section" title="Classless discipline TBF"><div class="titlepage"><div><div><h3 class="title"><a name="tbf"></a>Classless discipline TBF</h3></div></div></div><p>Token Bucket Filter (TBF) — a simple classless discipline, which
        transmits the coming packets at a bitrate not exceeding the set value.
        This discipline is very economical in terms of system resources,
        therefore it is a best choice when it is needed just to limit the
        speed of the outcoming traffic.</p><p>The essense of the discipline is the following. Packets coming
        for tranferring are capture in discipline buffer, from which they are
        transferred to the outgoing interface at a pre-set speed. The three
        situations are possible:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Packets come at the speed equal to the speed of their
            transferring to the outgoing interface. In this case the packets
            go through the interface without any delays.</p></li><li class="listitem"><p>Packets come at the speed less than the speed of their
            transferring to the outgoing interface. In this case during short
            periods of increase in the incoming traffic speed it will be
            accumulated in the incoming queue and then transmitted at the
            pre-set speed.</p></li><li class="listitem"><p>Packets come at the speed exceeding the speed of their
            transferring to the outgoing interface. In this case the packets
            will begin to drop after a while.</p></li></ul></div><p>Discipline has several parameters allowing to manage its
        performance:</p><div class="figure"><a name="id429649"></a><p class="title"><b>Figure 8.19. TBF configuration</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos-tbf.png" width="540" alt="TBF configuration"></td></tr></table></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Rate</em></span> — speed at which the incoming
            traffic is transmitted to the outgoing interface.</p></li></ul></div></div><div class="section" title="Class-specific discipline HTB"><div class="titlepage"><div><div><h3 class="title"><a name="htb"></a>Class-specific discipline HTB</h3></div></div></div><p>The HTB discipline allows to separate different throughput of
        the channel for different types of traffic. It is done by means of
        traffic distribution along different classes, each of which has a
        pre-set throughput value. The traffic classification can be done on
        the basis of IP-addresses or source/destionation ports. This type of
        traffic processing (limitation of its speed) is called
        <span class="emphasis"><em>shaping</em></span>.</p><p>First of all it should be noted that the user can control the
        speed only of the outgoing traffic (which is reasonable), therefore it
        is important to define the interface at which the traffic will be
        outgoing correctly, when adding the rules of shaping.</p><p>Realization of QoS on the basis of the class-specific discipline
        HTB consists of two steps — class definition and traffic distribution
        in classes according to certain criteria using filters. Classes
        defining the traffic speed can be added either to the root, or to
        other sublasses, forming a hierarchy of classes. Filters are added
        into the root of the hierarchy.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>The peculiarity of classes consists in fact that the speed of
          one subclass can be increased (withing the value of the parent class
          speed) due to <span class="emphasis"><em>unused</em></span> speed of another
          subclass.</p></div><p>For the discipline a class can be created to which all the
        traffic not complying with any filter will be transmitted.</p><div class="figure"><a name="id429726"></a><p class="title"><b>Figure 8.20. Class on default</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos-htb-default-class.png" width="540" alt="Class on default"></td></tr></table></div></div></div><br class="figure-break"><p>The table below contains information about classes. Optionally,
        for each class can be added own classless discipline of service
        described above.</p><div class="figure"><a name="qos_class"></a><p class="title"><b>Figure 8.21. Traffic classes</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos-class.png" width="540" alt="Traffic classes"></td></tr></table></div></div></div><br class="figure-break"><p>Class addition window is shown below.</p><div class="figure"><a name="htb_class_add"></a><p class="title"><b>Figure 8.22. Addition of a class</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos-class-add.png" width="540" alt="Addition of a class"></td></tr></table></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Enabled</em></span> — the class is active or
            not.</p></li><li class="listitem"><p><span class="emphasis"><em>Name</em></span> — name of the class being added.
            Used for traffic classification in filter.</p></li><li class="listitem"><p><span class="emphasis"><em>Parent class</em></span> - root class. When a class
            is added into a non-root class - it is called
            <span class="emphasis"><em>subclass</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>Rate</em></span> — throughput of a class. Should
            not exceed the speed of the parent class!</p></li><li class="listitem"><p><span class="emphasis"><em>Ceil</em></span> — maximum throughput of a subclass
            (in case when another subclass of the same class does not use the
            full volume of the throughput given to it). Should not exceed the
            speed of the parent class!</p></li><li class="listitem"><p><span class="emphasis"><em>Qdisc</em></span> — an optional classless
            discipline of class service. Here the name of the serviced
            discipline and its parameters can be indicated, for example:
            <span class="command"><strong>esfq#limit#128#depth#128#divisor#10#hash#classic#perturb#15</strong></span>
            or <span class="command"><strong>sfq#perturb#10</strong></span>, etc. Spacing should be
            substituted with <span class="emphasis"><em>#</em></span> symbol. The detailed
            information about the classless disciplines and their parameters
            is given above.</p></li></ul></div><p>To avoid the confusion, let`s pay attention to the abbreviations
        conventional for QoS which describes the rate:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>mbps = 1024 kbps = 1024 * 1024 bps =&gt; byte/s =&gt; 1024
            kbytes/sec.</p></li><li class="listitem"><p>mbit = 1024 kbit =&gt; kilo bit/s =&gt; 1024
            kbit/sec.</p></li></ul></div><p>Table of filters dividing traffic into classes on the basis of
        certain criteria.</p><div class="figure"><a name="qos_filter"></a><p class="title"><b>Figure 8.23. Filters dividing traffic into classes</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos-filter.png" width="540" alt="Filters dividing traffic into classes"></td></tr></table></div></div></div><br class="figure-break"><p>A filter creation window is shown below.</p><div class="figure"><a name="htb_filter_add"></a><p class="title"><b>Figure 8.24. Addition of a filter</b></p><div class="figure-contents"><div><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="540"><tr><td><img src="img/wf2-qos-filter-add.png" width="540" alt="Addition of a filter"></td></tr></table></div></div></div><br class="figure-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Enabled</em></span> — the filter is active or
            not.</p></li><li class="listitem"><p><span class="emphasis"><em>Name</em></span> — name of the filter.</p></li><li class="listitem"><p><span class="emphasis"><em>Prio</em></span> — priority of the filter. The less
            is the value — the higher is the priority.</p></li><li class="listitem"><p><span class="emphasis"><em>Protocol</em></span> — traffic classification
            according to protocol.</p></li><li class="listitem"><p><span class="emphasis"><em>Source IP</em></span> — traffic classification
            according to source address.</p></li><li class="listitem"><p><span class="emphasis"><em>Destination IP</em></span> — traffic classification
            according to destination address.</p></li><li class="listitem"><p><span class="emphasis"><em>Source port</em></span> — traffic classification
            according to sourse port number.</p></li><li class="listitem"><p><span class="emphasis"><em>Destination port</em></span> — traffic
            classification according to destination port number.</p></li><li class="listitem"><p><span class="emphasis"><em>Class</em></span> — to which class the packet
            should be referred.</p></li></ul></div><p>The configuration describes in the figures has one class -
        <span class="emphasis"><em>main</em></span> - and two subclasses:
        <span class="emphasis"><em>voip</em></span> and <span class="emphasis"><em>data</em></span>. The subclass
        <span class="emphasis"><em>voip</em></span> is used for high priority traffic, at the
        rate of 1500 to 1900 kbit/sec. The subclass <span class="emphasis"><em>data</em></span>
        is used as a default class for all other traffic. Its rate value - 400
        to 1900 kbit/sec.</p><p>All the traffic coming from the node 192.168.2.10 is transmitted
        to the <span class="emphasis"><em>voip</em></span> subclass.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch08s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch08.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">NAT </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 9. Network services settings</td></tr></table></div></body></html>
